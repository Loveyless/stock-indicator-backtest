# Data Contract

本文档说明 `src/main.js` 读取的 CSV 数据格式约束与处理规则。

## 目录与文件

- 目录：项目根目录 `stock/`
- 文件：`stock/*.csv`

## 编码

- 默认按 `GBK` 解码（见 `src/main.js`）

## 必须列（缺一即报错）

以下列名必须存在于 CSV 表头：

- `交易日期`
- `最低价_复权`
- `最高价_复权`
- `收盘价_复权`

## 日期解析

`交易日期` 会被解析为 `YYYYMMDD` 整数，用于时间过滤（`--start/--end`）。

支持的常见格式：

- `YYYYMMDD`
- `YYYY-MM-DD`
- `YYYY/MM/DD`
- 以及以上格式后面再带时间的字符串（只取前 8 位日期）

## 行顺序（关键）

rolling(40) 与 “未来 N 日收益” 都依赖行序，因此 **每个 CSV 必须按 `交易日期` 升序排列**。

如果存在乱序/重复日期/跨市场数据混杂，本脚本不会自动修复，输出会失真。

## 数值解析与缺失处理

- 非数值/空字符串会被当作 `NaN`
- `closeAdj[i]==0` 或未来 `closeAdj[i+day]` 不存在时，对应 `ret_day[i]` 记为 `NaN`
- 统计 describe 只会计入有限值（`NaN/Infinity` 会被忽略）

