# Data Contract

本文档说明 `src/main.js` 读取的 CSV 数据格式约束与处理规则。

## 目录与文件

- 默认目录：项目根目录 `stock/`
- 可选：运行时传 `--data-dir=...` 指定数据目录
- 文件：`*.csv`

## 编码

- 默认按 `GBK` 解码（见 `src/main.js`）
- 可用 `--encoding=gbk|utf8|auto` 指定编码；`auto` 仅做 BOM 级别识别后回退 `GBK`

## 必须列（缺一即报错）

以下列名必须存在于 CSV 表头：

- `股票名称`（用于排除 ST）
- `交易日期`
- `收盘价_复权`（用于均线与买卖成交价）

## 常用可选列（缺失不会报错，但策略可能用不上）

若 CSV 中存在以下列，`src/main.js` 会一并读入并提供给策略（见 `STRATEGY_API.md`）：

- 复权价：`开盘价_复权`、`最高价_复权`、`最低价_复权`
- 原始价：`开盘价`、`最高价`、`最低价`、`收盘价`、`前收盘价`
- 成交：`成交量`、`成交额`
- 市值：`流通市值`、`总市值`
- `涨跌幅`

## 日期解析

`交易日期` 会被解析为 `YYYYMMDD` 整数，用于时间过滤（`--start/--end`）。

支持的常见格式：

- `YYYYMMDD`
- `YYYY-MM-DD`
- `YYYY/MM/DD`
- 以及以上格式后面再带时间的字符串（只取前 8 位日期）

## 行顺序（关键）

均线计算与日期定位都依赖行序，因此 **每个 CSV 必须按 `交易日期` 升序排列**。

如果存在乱序/重复日期/跨市场数据混杂，本脚本不会自动修复，输出会失真。

## 数值解析与缺失处理

- 非数值/空字符串会被当作 `NaN`
- 若 `收盘价_复权` 为 `NaN/<=0`，该日无法用于计算均线/成交价，可能导致该股票在当周不被选中或无法成交（表现为交易减少）

